<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>QR Pro ‚Äì Tao ma QR mien phi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f5f5f5;margin:0;padding:20px;color:#222}
    h1{text-align:center}
    .box{background:#fff;max-width:480px;margin:auto;padding:25px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
    label{display:block;margin-top:15px;font-weight:bold}
    textarea,input,select{width:100%;padding:8px;margin-top:5px;border:1px solid #ccc;border-radius:4px;font-size:14px}
    button{cursor:pointer;padding:10px 18px;border:none;border-radius:4px;font-size:14px;margin-top:10px}
    #btnGen{background:#1976d2;color:#fff}
    #btnSave{background:#388e3c;color:#fff;display:none}
    #preview{text-align:center;margin-top:20px}
  </style>
</head>

<body>
  <h1>‚ú® QR Pro ‚Äì T·∫°o m√£ QR</h1>
  <div class="box">
    <label>N·ªôi dung QR:</label>
    <textarea id="data" rows="3" placeholder="V√≠ d·ª•: https://myweb.com"></textarea>

    <label>Ghi ch√∫ (1-3 d√≤ng):</label>
    <textarea id="note" rows="3" placeholder="V√≠ d·ª•: QU√âT M√É QR ƒê·ªÇ TRUY C·∫¨P"></textarea>

    <label>M√†u QR:</label>
    <select id="color">
      <option value="#000000">ƒêen</option>
      <option value="#b71c1c">ƒê·ªè</option>
      <option value="#0d47a1">Xanh d∆∞∆°ng</option>
      <option value="#1b5e20">Xanh l√°</option>
      <option value="#4a148c">T√≠m</option>
    </select>

    <label>Logo (PNG/JPG):</label>
    <input type="file" id="logo" accept="image/png, image/jpeg">

    <button id="btnGen">‚ú® T·∫°o m√£ QR</button>
    <button id="btnSave">üíæ T·∫£i ·∫£nh</button>

    <div id="preview"></div>
  </div>

  <footer style="text-align:center;margin-top:40px;font-size:13px;color:#555">
    <hr style="border:none;border-top:1px solid #ddd;margin-bottom:15px">
    üñãÔ∏è Made with ‚ù§Ô∏è by <strong>Tr·∫ßn Ho√†i D∆∞∆°ng</strong> &nbsp;‚Ä¢&nbsp;
    <a href="https://github.com/trahoaduon" target="_blank" style="color:#1976d2">GitHub</a> &nbsp;‚Ä¢&nbsp;
    <a href="mailto:trahoaduon@gmail.com" style="color:#1976d2">Contact</a>
  </footer>

<script>
const dataEl      = document.getElementById('data');
const noteEl      = document.getElementById('note');
const colorEl     = document.getElementById('color');
const logoEl      = document.getElementById('logo');
const btnGen      = document.getElementById('btnGen');
const btnSave     = document.getElementById('btnSave');
const preview     = document.getElementById('preview');
let   finalImgURL = '';

btnGen.onclick = async () => {
  const text = dataEl.value.trim();
  if (!text) return alert('Vui l√≤ng nh·∫≠p n·ªôi dung QR!');
  const color = colorEl.value;
  const note  = noteEl.value.trim();

  /* 1. Canvas QR g·ªëc 650√ó650 */
  const qrCanvas = document.createElement('canvas');
  const QR_SIZE = 650;
  qrCanvas.width = qrCanvas.height = QR_SIZE;
  await QRCode.toCanvas(qrCanvas, text, {
    width: QR_SIZE, margin: 2, color: { dark: color, light: '#ffffff' }
  });

  /* 2. Logo ‚Üí v·∫Ω tr·ª±c ti·∫øp l√™n qrCanvas */
  function centerLogo(img) {
    const s = Math.floor(QR_SIZE * 0.20);
    const x = (QR_SIZE - s) / 2;
    const y = (QR_SIZE - s) / 2;
    qrCanvas.getContext('2d').drawImage(img, x, y, s, s);
  }

  /* 3. Scale + th√™m ghi ch√∫ ‚Üí canvas cu·ªëi */
    /* 3. KH√îNG scale n·ªØa ‚Üí gi·ªØ 650√ó650, th√™m ch·ªØ b√™n d∆∞·ªõi */
    /* 3. KH√îNG scale n·ªØa ‚Üí gi·ªØ 650√ó650, th√™m ch·ªØ b√™n d∆∞·ªõi */
  function buildFinal() {
    const tempCanvas = document.createElement('canvas');
    const tctx = tempCanvas.getContext('2d');
    const QR_W = QR_SIZE; // 650
    let h = QR_W;
    if (note) {
      const lines  = note.split('\n').slice(0, 3);
      const fontSz = Math.max(28, QR_W / 23); // ch·ªØ to h∆°n m·ªôt ch√∫t
      const lineH  = fontSz + 12;
      const textH  = lineH * lines.length + 30;
      h = QR_W + textH;
      tempCanvas.width = QR_W; tempCanvas.height = h;
      tctx.fillStyle = '#fff'; tctx.fillRect(0, 0, QR_W, h);
      tctx.drawImage(qrCanvas, 0, 0); // KH√îNG scale
      tctx.fillStyle = '#000'; tctx.font = `${fontSz}px Arial`;
      let y = QR_W + 20 + fontSz;
      lines.forEach(l => {
        const w = tctx.measureText(l).width;
        tctx.fillText(l, (QR_W - w) / 2, y); y += lineH;
      });
    } else {
      tempCanvas.width = QR_W; tempCanvas.height = h;
      tctx.drawImage(qrCanvas, 0, 0);
    }
    finalImgURL = tempCanvas.toDataURL('image/png');
    preview.innerHTML = '<img src="' + finalImgURL + '" style="max-width:100%">';
    btnSave.style.display = 'inline-block';
  }

  /* 4. X·ª≠ l√Ω logo */
  if (logoEl.files && logoEl.files[0]) {
    const img = new Image();
    img.onload = () => { centerLogo(img); buildFinal(); };
    img.onerror = () => buildFinal();
    img.src = URL.createObjectURL(logoEl.files[0]);
  } else {
    fetch('logo-qr.jpg')
      .then(r => r.ok ? r.blob() : Promise.reject())
      .then(b => {
        const img = new Image();
        img.onload = () => { centerLogo(img); buildFinal(); };
        img.onerror = () => buildFinal();
        img.src = URL.createObjectURL(b);
      })
      .catch(() => buildFinal());
  }
};

btnSave.onclick = () => {
  const a = document.createElement('a');
  a.href = finalImgURL;
  a.download = 'qr-pro.png';
  a.click();
};
</script>
</body>
</html>